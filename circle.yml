machine:
  environment:
    GO15VENDOREXPERIMENT: 1
    GOROOT: "/home/ubuntu/go"
    PATH: "/home/ubuntu/go/bin:$PATH"
    GOVERSION: "1.7.4"

dependencies:
  cache_directories:
    - "/home/ubuntu/go"
  pre:
    # Install Golang
    - if [[ ! -e /home/ubuntu/go/bin/go ]]; then cd /home/ubuntu; curl https://storage.googleapis.com/golang/go$GOVERSION.linux-amd64.tar.gz | tar -xz; fi
    - go version
    # Install Glide
    - |
      curl -o glide.tar.gz -sL https://github.com/Masterminds/glide/releases/download/v0.12.3/glide-v0.12.3-linux-amd64.tar.gz &&
      tar -xvzf glide.tar.gz &&
      sudo cp linux-amd64/glide /usr/local/bin/glide &&
      sudo chmod a+w /usr/local/bin/glide
    - glide --version
  override:
    - glide update -v

test:
  override:
    - go test $(go list ./...|grep -v vendor) -v